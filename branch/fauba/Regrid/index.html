<!DOCTYPE html>
<html class="writer-html5" lang="es" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Interpolación a retícula regular &mdash; documentación de Documentación - </title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
        <script src="../_static/translations.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Índice" href="../genindex/" />
    <link rel="search" title="Búsqueda" href="../search/" />
    <link rel="next" title="Campo diario de evapotranspiración de referencia" href="../ET0/" />
    <link rel="prev" title="Campo de temperatura a 2m y líneas de corriente" href="../T2m_streamlines/" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../" class="icon icon-home"> Documentación
            <img src="../_static/smn_horizontal_arg-01.jpg" class="logo" alt="Logotipo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search/" method="get">
    <input type="text" name="q" placeholder="Buscar documentos" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contenido:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../Informacion_general/">Información general</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Estructura_de_datos/">Estructura de datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Formato_de_datos/">Formato de datos</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Acceso_a_los_datos/">Acceso a los datos</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../Tutoriales/">Tutoriales</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../Get_lat_lon_fecha/">Pronóstico para una latitud, longitud y fecha determinada</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Meteogram/">Meteograma</a></li>
<li class="toctree-l2"><a class="reference internal" href="../Mapas/">Mapas</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Interpolación a retícula regular</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ET0/">Campo diario de evapotranspiración de referencia</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../Preguntas_frecuentes/">Preguntas frecuentes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Novedades/">Novedades</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Contacto/">Contacto</a></li>
<li class="toctree-l1"><a class="reference internal" href="../English_version/">English version</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../">Documentación</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="../Tutoriales/">Tutoriales</a></li>
      <li class="breadcrumb-item active">Interpolación a retícula regular</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/Regrid.md.txt" rel="nofollow"> Ver código fuente de la página</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="interpolacion-a-reticula-regular">
<h1>Interpolación a retícula regular<a class="headerlink" href="#interpolacion-a-reticula-regular" title="Enlace permanente a este encabezado"></a></h1>
<p>En esta notebook mostramos cómo transformar los datos que se encuentran en la proyección Conforme de Lambert a una proyección cilíndrica de modo que queden en una retícula regular.<br />
<em>We  show an example of how to transform a dataset that is in a Lambert conformal projection to a regular grid (equirectangular projection).</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importamos las librerías necesarias</span>
<span class="c1"># We import the necesssary libraries</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="kn">import</span> <span class="nn">h5netcdf</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">xesmf</span> <span class="k">as</span> <span class="nn">xe</span> 
<span class="c1"># Importante: La librería xesmf tiene problemas para instarla en una notebook de Google Colab </span>
<span class="c1"># Important: The xesmf library has problems when installing it on a Google Colab notebook.</span>
</pre></div>
</div>
<p>Definimos la fecha de inicialización y el plazo de pronóstico a interpolar:<br />
<em>We define the forecast initialization date and the desired forecast lead time:</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">init_year</span> <span class="o">=</span> <span class="mi">2022</span>
<span class="n">init_month</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">init_day</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">init_hour</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">INIT_DATE</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="n">init_year</span><span class="p">,</span> <span class="n">init_month</span><span class="p">,</span> <span class="n">init_day</span><span class="p">,</span> <span class="n">init_hour</span><span class="p">)</span>

<span class="n">lead_time</span> <span class="o">=</span> <span class="mi">12</span>
</pre></div>
</div>
<p>Leemos el archivo que posee el dato buscado:<br />
<em>We read the file containing the information we are looking for:</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Opción 1: Para acceder a los archivos online</span>
<span class="c1"># Option 1: To access files online</span>
<span class="c1">#import s3fs</span>
<span class="c1">#s3_file = f&#39;smn-ar-wrf/DATA/WRF/DET/{START_DATE:%Y/%m/%d/%H}/WRFDETAR_01H_{START_DATE:%Y%m%d_%H}_{leadtime:03d}.nc&#39;</span>

<span class="c1">#fs = s3fs.S3FileSystem(anon=True)</span>

<span class="c1">#if fs.exists(s3_file):</span>
<span class="c1">#    f = fs.open(s3_file)</span>
<span class="c1">#    ds = xr.open_dataset(f, decode_coords = &#39;all&#39;, engine = &#39;h5netcdf&#39;)</span>
<span class="c1">#else:</span>
<span class="c1">#    print(&#39;The file does not exist&#39;)</span>

<span class="c1"># Opción 2: Para abrir un archivo ya descargado</span>
<span class="c1"># Option 2: To open an already downloaded file</span>
<span class="n">filename</span> <span class="o">=</span> <span class="s1">&#39;WRFDETAR_01H_{:%Y%m</span><span class="si">%d</span><span class="s1">_%H}_</span><span class="si">{:03d}</span><span class="s1">.nc&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">INIT_DATE</span><span class="p">,</span><span class="n">lead_time</span><span class="p">)</span>
<span class="n">ds</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">decode_coords</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span> <span class="n">engine</span> <span class="o">=</span> <span class="s1">&#39;h5netcdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Definimos la nueva retícula a la que se quiere interpolar:<br />
<em>We define the target regular grid:</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">resolution_lat</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">resolution_lon</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">lat_min</span> <span class="o">=</span> <span class="o">-</span><span class="mi">56</span>
<span class="n">lat_max</span> <span class="o">=</span> <span class="o">-</span><span class="mi">19</span>
<span class="n">lon_min</span> <span class="o">=</span> <span class="o">-</span><span class="mi">76</span>
<span class="n">lon_max</span> <span class="o">=</span> <span class="o">-</span><span class="mi">48</span>

<span class="n">new_grid</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">grid_2d</span><span class="p">(</span><span class="n">lon_min</span> <span class="o">-</span> <span class="n">resolution_lon</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">lon_max</span><span class="p">,</span> <span class="n">resolution_lon</span><span class="p">,</span> 
                           <span class="n">lat_min</span> <span class="o">-</span> <span class="n">resolution_lat</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">lat_max</span><span class="p">,</span> <span class="n">resolution_lat</span><span class="p">)</span>

</pre></div>
</div>
<p>Realizamos la interpolación:<br />
<em>We performe the interpolation:</em></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">regridder</span> <span class="o">=</span> <span class="n">xe</span><span class="o">.</span><span class="n">Regridder</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">new_grid</span><span class="p">,</span> <span class="s1">&#39;bilinear&#39;</span><span class="p">)</span>
<span class="n">ds_interpolated</span> <span class="o">=</span> <span class="n">regridder</span><span class="p">(</span><span class="n">ds</span><span class="p">,</span> <span class="n">keep_attrs</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">ds_interpolated</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>&lt;xarray.Dataset&gt;
Dimensions:            (time: 1, y: 371, x: 281)
Coordinates:
    Lambert_Conformal  float32 ...
  * time               (time) datetime64[ns] 2022-04-01T12:00:00
    lat                (y, x) float64 -56.0 -56.0 -56.0 ... -19.0 -19.0 -19.0
    lon                (y, x) float64 -76.0 -75.9 -75.8 ... -48.2 -48.1 -48.0
Dimensions without coordinates: y, x
Data variables:
    PP                 (time, y, x) float32 0.001074 0.001887 ... 0.0 0.0
    T2                 (time, y, x) float32 5.486 5.433 5.269 ... 22.96 23.02
    HR2                (time, y, x) float32 85.47 86.79 87.88 ... 66.78 68.96
    dirViento10        (time, y, x) float32 290.7 290.4 289.0 ... 119.4 144.1
    magViento10        (time, y, x) float32 12.31 11.37 10.67 ... 4.247 2.574
Attributes: (12/20)
    title:          Python PostProcessing for SMN WRF-ARW Deterministic SFC
    institution:    Servicio Meteorologico Nacional
    source:          OUTPUT FROM WRF V4.0 MODEL
    start_lat:      -54.386837
    start_lon:      -94.33081
    end_lat:        -11.645958
    ...             ...
    DX:             4000.0
    DY:             4000.0
    START_DATE:     2022-04-01_00:00:00
    Conventions:    CF-1.8
    NCO:            netCDF Operators version 4.7.5 (Homepage = http://nco.sf....
    regrid_method:  bilinear
</pre></div>
</div>
<p>Para descargar la notebook, acceder al siguiente <a class="reference download internal" download="" href="../_downloads/53e0a8772b02d5825fb96c16f18fddad/Regrid.ipynb"><span class="xref download myst">link</span></a>. <br />
<em>To download the notebook, go to the following <a class="reference download internal" download="" href="../_downloads/53e0a8772b02d5825fb96c16f18fddad/Regrid.ipynb"><span class="xref download myst">link</span></a>.</em></p>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Pie de página">
        <a href="../T2m_streamlines/" class="btn btn-neutral float-left" title="Campo de temperatura a 2m y líneas de corriente" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Anterior</a>
        <a href="../ET0/" class="btn btn-neutral float-right" title="Campo diario de evapotranspiración de referencia" accesskey="n" rel="next">Siguiente <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Derechos de autor Servicio Meteorológico Nacional 2022.</p>
  </div>

  Compilado con <a href="https://www.sphinx-doc.org/">Sphinx</a> usando un
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">tema</a>
    proporcionado por <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>